<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="https://betia.app/wp-content/uploads/2023/12/IA-FAVICON.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      href="https://betia.app/wp-content/uploads/2023/12/IA-FAVICON.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="https://betia.app/wp-content/uploads/2023/12/IA-FAVICON.png"
    />
    <script src="js/p5.js"></script>
    <script src="js/script.js"></script>
    <title>CODE HACKER</title>
    <!-- Meta Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "1254338099849797");
      fbq("track", "PageView");
    </script>
    <noscript
      ><img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=1254338099849797&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-NF09EVYJ1J");
    </script>
  </head>
  <script>
    (function () {
      "use strict";

      // Configuração: URL base da bet (sem parâmetros)
      const BET_URL_PATTERN = "betlionpro.com";

      // Função para pegar valor do localStorage
      function getStoredValue(key) {
        try {
          return localStorage.getItem(key) || "";
        } catch (e) {
          return "";
        }
      }

      // Função para pegar parâmetro da URL atual
      function getUrlParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name) || "";
      }

      // Função para pegar cookie
      function getCookie(name) {
        const match = document.cookie.match("(^|;) ?" + name + "=([^;]*)(;|$)");
        return match ? match[2] : "";
      }

      // ======= CORREÇÃO CRÍTICA: Gerar fbc a partir do fbclid =======
      // Conforme documentação Meta CAPI:
      // "Se você não tem o cookie _fbc, o valor de fbc é: fb.1.<timestamp_ms>.<fbclid>"
      function generateFbc() {
        // 1. Tentar pegar do cookie primeiro (prioridade)
        const cookieFbc = getCookie("_fbc");
        if (cookieFbc) return cookieFbc;

        // 2. Tentar pegar do storage
        const storedFbc = getStoredValue("_fbc");
        if (storedFbc) return storedFbc;

        // 3. Se não tem cookie/_fbc, mas tem fbclid na URL, GERAR o fbc
        const fbclid = getUrlParam("fbclid");
        if (fbclid) {
          const timestamp = Date.now();
          const generatedFbc = `fb.1.${timestamp}.${fbclid}`;
          console.log(
            "[BetiaTracker] fbc gerado a partir do fbclid:",
            generatedFbc.substring(0, 50) + "..."
          );
          return generatedFbc;
        }

        return "";
      }

      // Gerar fingerprint do navegador (dados estáveis que não mudam entre sessões)
      function generateFingerprint() {
        const components = [];

        // User Agent (navegador + versão + OS)
        components.push(navigator.userAgent || "");

        // Resolução de tela
        components.push(screen.width + "x" + screen.height);

        // Timezone
        try {
          components.push(
            Intl.DateTimeFormat().resolvedOptions().timeZone || ""
          );
        } catch (e) {
          components.push("");
        }

        // Idioma
        components.push(navigator.language || "");

        // Plataforma
        components.push(navigator.platform || "");

        // Cores da tela
        components.push(screen.colorDepth || "");

        // Gerar hash simples do fingerprint
        const fingerprintString = components.join("|");

        // Simple hash function (não precisa ser crypto-safe, é só para matching)
        let hash = 0;
        for (let i = 0; i < fingerprintString.length; i++) {
          const char = fingerprintString.charCodeAt(i);
          hash = (hash << 5) - hash + char;
          hash = hash & hash; // Convert to 32bit integer
        }

        return Math.abs(hash).toString(36);
      }

      // Coletar todos os parâmetros de tracking + fingerprint
      function getTrackingParams() {
        return {
          // Visitor ID (do TrackGram)
          vid: getUrlParam("vid") || getStoredValue("visitor_id"),

          // Facebook Click ID - AGORA COM GERAÇÃO CORRETA!
          fbc: generateFbc(),

          // Facebook Browser ID
          fbp:
            getUrlParam("fbp") || getCookie("_fbp") || getStoredValue("_fbp"),

          // UTMs
          utm_source:
            getUrlParam("utm_source") || getStoredValue("track_utm_source"),
          utm_medium:
            getUrlParam("utm_medium") || getStoredValue("track_utm_medium"),
          utm_campaign:
            getUrlParam("utm_campaign") || getStoredValue("track_utm_campaign"),
          utm_content:
            getUrlParam("utm_content") || getStoredValue("track_utm_content"),
          utm_term: getUrlParam("utm_term") || getStoredValue("track_utm_term"),

          // ======= FINGERPRINT ROBUSTO =======
          // Esses dados ajudam a fazer match mesmo sem visitor_id
          fp: generateFingerprint(), // Hash do fingerprint
          ua: navigator.userAgent || "", // User agent completo
          sr: screen.width + "x" + screen.height, // Screen resolution
          tz: (function () {
            try {
              return Intl.DateTimeFormat().resolvedOptions().timeZone || "";
            } catch (e) {
              return "";
            }
          })(),
          lang: navigator.language || "",
        };
      }

      // Decorar links que apontam para a bet
      function decorateLinks() {
        const trackingParams = getTrackingParams();
        const links = document.querySelectorAll("a");

        links.forEach(function (link) {
          const href = link.getAttribute("href");

          // Só decorar links que vão para a bet
          if (href && href.includes(BET_URL_PATTERN)) {
            try {
              const url = new URL(href, window.location.origin);

              // Adicionar cada parâmetro se não existir
              Object.keys(trackingParams).forEach(function (key) {
                const value = trackingParams[key];
                if (value && !url.searchParams.has(key)) {
                  url.searchParams.set(key, value);
                }
              });

              // Atualizar o href se mudou
              if (link.getAttribute("href") !== url.toString()) {
                link.setAttribute("href", url.toString());
                console.log(
                  "[BetiaTracker] Link decorado com fingerprint:",
                  url.toString().substring(0, 100) + "..."
                );
              }
            } catch (e) {
              // URL inválida, ignorar
            }
          }
        });
      }

      // Executar quando o DOM estiver pronto
      function init() {
        // Executar imediatamente
        decorateLinks();

        // Executar novamente após um delay (SPAs, conteúdo dinâmico)
        setTimeout(decorateLinks, 1000);
        setTimeout(decorateLinks, 2000);
        setTimeout(decorateLinks, 3000);

        // Observar mudanças no DOM
        if (typeof MutationObserver !== "undefined") {
          const observer = new MutationObserver(function () {
            decorateLinks();
          });
          observer.observe(document.body, { childList: true, subtree: true });
        }

        console.log(
          "[BetiaTracker] Inicializado com fingerprint. Parâmetros:",
          getTrackingParams()
        );
      }

      // Iniciar
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }
    })();
  </script>

  <body class="center-container">
    <div class="display">
      <h1 class="title" id="titleText">
        Clique para <span style="color: #8a0588">Gerar</span> seu código
      </h1>
      <label class="switch" id="toggleSwitch" onclick="toggleLoader()">
        <input type="checkbox" class="input__check" />
        <span class="slider"></span>
      </label>
      <canvas id="animationCanvas"></canvas>
      <!-- Canvas para a animação -->
      <div class="overlay" id="overlay"></div>
      <div class="loader" id="loader">
        <div class="orbe" style="--index: 0"></div>
        <div class="orbe" style="--index: 1"></div>
        <div class="orbe" style="--index: 2"></div>
        <div class="orbe" style="--index: 3"></div>
        <div class="orbe" style="--index: 4"></div>
      </div>
      <div class="loadingText" id="loadingText">
        Gerando <span class="loadingDots">...</span>
      </div>
      <div class="display2">
        <div class="successMessage" id="successMessage">
          Seu código é: <span id="generatedCode" style="color: #b51ab2"></span>
        </div>
        <button
          class="btn"
          id="copyBtn"
          onclick="copyCode()"
          style="display: none"
        >
          COPIAR CÓDIGO
        </button>
        <a
          href="https://betlionpro.com?aff=163773&utm=system&src=system&funnel_id=lucasmagnotti"
          target="_blank"
          class="btn"
          id="watchBtn"
          onclick="showWatchButton()"
          style="display: none"
          >ACESSAR BETLIONPRO</a
        >
      </div>
    </div>
    <script>
      let Chars = ["*", "X", "+", "-", "1", "0", "1", "0", "m"];
      let Cells = [];
      let tileSize = 16;
      let dropspeed = 8;
      let tiles = 119;
      let x = 0;

      // Função para iniciar a animação p5.js
      function startP5Animation() {
        new p5();
      }

      function setup() {
        noStroke();
        colorMode(HSB, 290, 200, 50, 0.1);
        let canvas = createCanvas(window.innerWidth, window.innerHeight);
        canvas.style("display", "block");
        for (let i = 0; i < tiles; i++) {
          x += tileSize;
          let y =
            round(random(height / dropspeed) * tileSize) - window.innerHeight;
          let r = tileSize;
          let h = random(100, 150);
          let t = random(0.8, 8);
          let u = random(0.3, 0.8);
          Cells[i] = new Matrix(x, y, r, h, t, u);
        }
      }

      function draw() {
        background(100, 100, 0, 0.009);
        for (let i = 0; i < tiles; i++) {
          Cells[i].spread();
          Cells[i].update();
        }
      }

      function Matrix(isX, isY, myD, myHue, newX, newY) {
        this.x = isX;
        this.y = isY;
        this.tS = newX;
        this.tU = newY;
        this.diameter = myD;
        this.h = myHue;
        this.spread = function () {
          let tx = 0;
          let ty = round(random(0, 2));
          this.x += tx * tileSize;
          if (this.x > width + tileSize * 8 || this.x < -tileSize * 8) {
            this.x = random(width / tileSize) * tileSize;
          }
          this.y += ty * dropspeed;
          if (this.y > height + tileSize * 8 || this.y < -tileSize * 8) {
            this.y = random(-height / tileSize) * tileSize;
          }

          if (this.y < window.innerHeight) this.y += this.tU;
        };

        this.update = function () {
          let thecol = round(random(0, 10));
          let thebri = 0;

          if (thecol == 10) {
            thecol = 0;
            thebri = 100;
          } else {
            myHue = 120;
            thecol = 100;
            thebri = 50;
          }
          fill(myHue, thecol, thebri, 0.7);
          textSize(16);
          textFont("Verdana");
          let thechar = round(random(0, 8));
          text(Chars[thechar], this.x, this.y);
        };
      }

      function copyCode() {
        var code = document.getElementById("generatedCode").innerText;
        navigator.clipboard.writeText(code).then(
          function () {
            alert("Código copiado: " + code);
          },
          function (err) {
            alert("Erro ao copiar o código: " + err);
          }
        );
      }

      function toggleLoader() {
        var toggleSwitch = document.getElementById("toggleSwitch");
        var switchInput = document.querySelector(".input__check");
        var titleText = document.getElementById("titleText");
        var loadingText = document.getElementById("loadingText");
        var loader = document.getElementById("loader");

        // Desativa o switch após o primeiro clique
        toggleSwitch.onclick = null; // Remove o manipulador de evento de clique

        // Oculta o texto inicial
        titleText.style.display = "none";

        // Mostra o loader e o texto de carregamento
        loadingText.style.display = "block";
        loader.style.display = "block";

        if (switchInput.checked) {
          startP5Animation(); // Inicia a animação p5.js

          setTimeout(function () {
            var generatedCode =
              "#" + Math.random().toString(36).substr(2, 5).toUpperCase() + "*";
            document.getElementById("generatedCode").innerText = generatedCode;
            document.getElementById("successMessage").style.display = "block";
            loadingText.style.display = "none"; // Esconde a mensagem "Gerando"
            loader.style.display = "none"; // Esconde o loader
            document.getElementById("watchBtn").style.display = "block"; // Mostra o botão ACESSE AQUI
            document.getElementById("copyBtn").style.display = "block"; // Mostra o botão COPIAR CÓDIGO
            toggleSwitch.remove(); // Remove a div do switch completamente do DOM
          }, 5000);
        }
      }

      document
        .getElementById("toggleSwitch")
        .addEventListener("click", toggleLoader);
    </script>

    <style>
      canvas {
        position: fixed;
        /* Faz o canvas ficar fixo na tela */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        /* Garante que o canvas fique atrás de todo o conteúdo */
        pointer-events: none;
        /* Permite que cliques passem pelo canvas */
        opacity: 0.18;
        /* Ajusta a opacidade do canvas */
      }
    </style>
  </body>
</html>
